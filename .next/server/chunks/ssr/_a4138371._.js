module.exports=[47349,(a,b,c)=>{"use strict";var d=a.r(72131);d.useState,d.useEffect,d.useLayoutEffect,d.useDebugValue,c.useSyncExternalStore=void 0!==d.useSyncExternalStore?d.useSyncExternalStore:function(a,b){return b()}},87610,(a,b,c)=>{"use strict";b.exports=a.r(47349)},43609,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(99570),f=a.i(91119),g=a.i(97503),h=a.i(91675);a.i(35112);var i=a.i(11011),j=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((a,d)=>{let e=(0,i.createSlot)(`Primitive.${d}`),f=c.forwardRef((a,c)=>{let{asChild:f,...g}=a;return(0,b.jsx)(f?e:d,{...g,ref:c})});return f.displayName=`Primitive.${d}`,{...a,[d]:f}},{}),k="horizontal",l=["horizontal","vertical"],m=c.forwardRef((a,c)=>{var d;let{decorative:e,orientation:f=k,...g}=a,h=(d=f,l.includes(d))?f:k;return(0,b.jsx)(j.div,{"data-orientation":h,...e?{role:"none"}:{"aria-orientation":"vertical"===h?h:void 0,role:"separator"},...g,ref:c})});m.displayName="Separator";var n=a.i(68114);let o=c.forwardRef(({className:a,orientation:c="horizontal",decorative:d=!0,...e},f)=>(0,b.jsx)(m,{ref:f,decorative:d,orientation:c,className:(0,n.cn)("shrink-0 bg-border","horizontal"===c?"h-[1px] w-full":"h-full w-[1px]",a),...e}));o.displayName=m.displayName;var p=a.i(29246),q=a.i(46872),r=a.i(72752),s=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((a,d)=>{let e=(0,i.createSlot)(`Primitive.${d}`),f=c.forwardRef((a,c)=>{let{asChild:f,...g}=a;return(0,b.jsx)(f?e:d,{...g,ref:c})});return f.displayName=`Primitive.${d}`,{...a,[d]:f}},{}),t=a.i(87610);function u(){return()=>{}}var v="Avatar",[w,x]=function(a,d=[]){let e=[],f=()=>{let b=e.map(a=>c.createContext(a));return function(d){let e=d?.[a]||b;return c.useMemo(()=>({[`__scope${a}`]:{...d,[a]:e}}),[d,e])}};return f.scopeName=a,[function(d,f){let g=c.createContext(f);g.displayName=d+"Context";let h=e.length;e=[...e,f];let i=d=>{let{scope:e,children:f,...i}=d,j=e?.[a]?.[h]||g,k=c.useMemo(()=>i,Object.values(i));return(0,b.jsx)(j.Provider,{value:k,children:f})};return i.displayName=d+"Provider",[i,function(b,e){let i=e?.[a]?.[h]||g,j=c.useContext(i);if(j)return j;if(void 0!==f)return f;throw Error(`\`${b}\` must be used within \`${d}\``)}]},function(...a){let b=a[0];if(1===a.length)return b;let d=()=>{let d=a.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(a){let e=d.reduce((b,{useScope:c,scopeName:d})=>{let e=c(a)[`__scope${d}`];return{...b,...e}},{});return c.useMemo(()=>({[`__scope${b.scopeName}`]:e}),[e])}};return d.scopeName=b.scopeName,d}(f,...d)]}(v),[y,z]=w(v),A=c.forwardRef((a,d)=>{let{__scopeAvatar:e,...f}=a,[g,h]=c.useState("idle");return(0,b.jsx)(y,{scope:e,imageLoadingStatus:g,onImageLoadingStatusChange:h,children:(0,b.jsx)(s.span,{...f,ref:d})})});A.displayName=v;var B="AvatarImage",C=c.forwardRef((a,d)=>{let{__scopeAvatar:e,src:f,onLoadingStatusChange:g=()=>{},...h}=a,i=z(B,e),j=function(a,{referrerPolicy:b,crossOrigin:d}){let e=(0,t.useSyncExternalStore)(u,()=>!0,()=>!1),f=c.useRef(null),g=e?(f.current||(f.current=new window.Image),f.current):null,[h,i]=c.useState(()=>F(g,a));return(0,r.useLayoutEffect)(()=>{i(F(g,a))},[g,a]),(0,r.useLayoutEffect)(()=>{let a=a=>()=>{i(a)};if(!g)return;let c=a("loaded"),e=a("error");return g.addEventListener("load",c),g.addEventListener("error",e),b&&(g.referrerPolicy=b),"string"==typeof d&&(g.crossOrigin=d),()=>{g.removeEventListener("load",c),g.removeEventListener("error",e)}},[g,d,b]),h}(f,h),k=(0,q.useCallbackRef)(a=>{g(a),i.onImageLoadingStatusChange(a)});return(0,r.useLayoutEffect)(()=>{"idle"!==j&&k(j)},[j,k]),"loaded"===j?(0,b.jsx)(s.img,{...h,ref:d,src:f}):null});C.displayName=B;var D="AvatarFallback",E=c.forwardRef((a,d)=>{let{__scopeAvatar:e,delayMs:f,...g}=a,h=z(D,e),[i,j]=c.useState(void 0===f);return c.useEffect(()=>{if(void 0!==f){let a=window.setTimeout(()=>j(!0),f);return()=>window.clearTimeout(a)}},[f]),i&&"loaded"!==h.imageLoadingStatus?(0,b.jsx)(s.span,{...g,ref:d}):null});function F(a,b){return a?b?(a.src!==b&&(a.src=b),a.complete&&a.naturalWidth>0?"loaded":"loading"):"error":"idle"}E.displayName=D;let G=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)(A,{ref:d,className:(0,n.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...c}));G.displayName=A.displayName,c.forwardRef(({className:a,...c},d)=>(0,b.jsx)(C,{ref:d,className:(0,n.cn)("aspect-square h-full w-full",a),...c})).displayName=C.displayName;let H=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)(E,{ref:d,className:(0,n.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",a),...c}));H.displayName=E.displayName;var I=a.i(74167),J=a.i(11642),K=a.i(210),L=a.i(70106);let M=(0,L.default)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);var N=a.i(67900);let O=(0,L.default)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);var P=a.i(92759),Q=a.i(67453),R=a.i(41710);let S=(0,L.default)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);var T=a.i(96221),U=a.i(72228),V=a.i(5483),W=a.i(58419);function X(a,b){let c=(0,W.toDate)(a),d=(0,W.toDate)(b),e=c.getTime()-d.getTime();return e<0?-1:e>0?1:e}var Y=a.i(12055),Z=a.i(34968),$=a.i(18982),_=a.i(8668),aa=a.i(23292),ab=a.i(88780);let ac=ab.z.object({reply_description:ab.z.string().min(1,"Reply cannot be empty").max(5e3,"Reply must be 5000 characters or less")});function ad(){let a=(0,d.useParams)(),i=a?.id,j=(0,d.useRouter)(),{user:k,role:l}=(0,J.useAuth)(),[m,n]=(0,c.useState)(null),[q,r]=(0,c.useState)([]),[s,t]=(0,c.useState)(!0),[u,v]=(0,c.useState)(""),[w,x]=(0,c.useState)(!1);(0,c.useEffect)(()=>{i&&(y(),z())},[i]);let y=async()=>{let{data:a,error:b}=await I.supabase.from("service_requests").select(`
        id,
        request_no,
        request_datetime,
        title,
        description,
        priority_level,
        approval_status,
        assigned_to_user_id,
        status:service_request_statuses(id, name),
        requester:profiles!service_requests_requester_id_fkey(id, name, email),
        assigned_to:profiles!service_requests_assigned_to_user_id_fkey(id, name),
        service_request_type:service_request_types(
          id,
          name,
          department:service_departments(id, name)
        )
      `).eq("id",i).single();b?(console.error("Error fetching request:",b),aa.toast.error("Failed to load request")):n(a),t(!1)},z=async()=>{let{data:a}=await I.supabase.from("service_request_replies").select(`
        id,
        reply_datetime,
        reply_description,
        user:profiles(name),
        status:service_request_statuses(name)
      `).eq("service_request_id",i).order("reply_datetime",{ascending:!0});a&&r(a)},A=async()=>{let a=ac.safeParse({reply_description:u.trim()});if(!a.success)return void aa.toast.error(a.error.errors[0]?.message||"Invalid reply");if(!m)return;x(!0);let{error:b}=await I.supabase.from("service_request_replies").insert([{service_request_id:m.id,user_id:k?.id,reply_description:a.data.reply_description,status_id:m.status.id,status_datetime:new Date().toISOString(),status_by_user_id:k?.id}]);b?(b.message.includes("replies_description_length")?aa.toast.error("Reply is too long (max 5000 characters)"):aa.toast.error("Failed to post reply"),console.error(b)):(aa.toast.success("Reply posted successfully"),v(""),z()),x(!1)};return s?(0,b.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,b.jsx)(T.Loader2,{className:"h-8 w-8 animate-spin text-primary"})}):m?(0,b.jsxs)("div",{className:"space-y-6 animate-fade-in max-w-4xl mx-auto",children:[(0,b.jsxs)("div",{className:"flex items-start gap-4",children:[(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",onClick:()=>j.back(),className:"mt-1",children:(0,b.jsx)(K.ArrowLeft,{className:"h-5 w-5"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,b.jsx)("span",{className:"font-mono text-sm text-muted-foreground",children:m.request_no}),(0,b.jsx)(g.StatusBadge,{status:m.status?.name||"Pending"}),(0,b.jsx)(h.PriorityBadge,{priority:m.priority_level})]}),(0,b.jsx)("h1",{className:"text-2xl font-bold font-display",children:m.title})]})]}),(0,b.jsxs)("div",{className:"grid gap-6 lg:grid-cols-3",children:[(0,b.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsx)(f.CardTitle,{className:"text-base",children:"Description"})}),(0,b.jsx)(f.CardContent,{children:(0,b.jsx)("p",{className:"whitespace-pre-wrap text-muted-foreground",children:m.description})})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsxs)(f.CardTitle,{className:"text-base flex items-center gap-2",children:[(0,b.jsx)(S,{className:"h-4 w-4"}),"Activity (",q.length,")"]})}),(0,b.jsxs)(f.CardContent,{className:"space-y-4",children:[q.length>0?q.map(a=>{var c,d;return(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)(G,{className:"h-8 w-8",children:(0,b.jsx)(H,{className:"text-xs bg-primary/10 text-primary",children:a.user?.name?.split(" ").map(a=>a[0]).join("")||"?"})}),(0,b.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"font-medium text-sm",children:a.user?.name||"Unknown"}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:(c=new Date(a.reply_datetime),d={addSuffix:!0},function(a,b,c){var d,e,f;let g,h,i,j=(0,$.getDefaultOptions)(),k=c?.locale??j.locale??Z.defaultLocale,l=X(a,b);if(isNaN(l))throw RangeError("Invalid time value");let m=Object.assign({},c,{addSuffix:c?.addSuffix,comparison:l});l>0?(g=(0,W.toDate)(b),h=(0,W.toDate)(a)):(g=(0,W.toDate)(a),h=(0,W.toDate)(b));let n=(d=h,e=g,(f=void 0,a=>{let b=(f?Math[f]:Math.trunc)(a);return 0===b?0:b})(((0,W.toDate)(d)-(0,W.toDate)(e))/1e3)),o=Math.round((n-((0,_.getTimezoneOffsetInMilliseconds)(h)-(0,_.getTimezoneOffsetInMilliseconds)(g))/1e3)/60);if(o<2)if(c?.includeSeconds)if(n<5)return k.formatDistance("lessThanXSeconds",5,m);else if(n<10)return k.formatDistance("lessThanXSeconds",10,m);else if(n<20)return k.formatDistance("lessThanXSeconds",20,m);else if(n<40)return k.formatDistance("halfAMinute",0,m);else if(n<60)return k.formatDistance("lessThanXMinutes",1,m);else return k.formatDistance("xMinutes",1,m);else if(0===o)return k.formatDistance("lessThanXMinutes",1,m);else return k.formatDistance("xMinutes",o,m);if(o<45)return k.formatDistance("xMinutes",o,m);if(o<90)return k.formatDistance("aboutXHours",1,m);if(o<Y.minutesInDay){let a=Math.round(o/60);return k.formatDistance("aboutXHours",a,m)}if(o<2520)return k.formatDistance("xDays",1,m);else if(o<Y.minutesInMonth){let a=Math.round(o/Y.minutesInDay);return k.formatDistance("xDays",a,m)}else if(o<2*Y.minutesInMonth)return i=Math.round(o/Y.minutesInMonth),k.formatDistance("aboutXMonths",i,m);if((i=function(a,b){var c;let d,e,f,g=(0,W.toDate)(a),h=(0,W.toDate)(b),i=X(g,h),j=Math.abs((e=(0,W.toDate)(g),f=(0,W.toDate)(h),12*(e.getFullYear()-f.getFullYear())+(e.getMonth()-f.getMonth())));if(j<1)d=0;else{let b,e,f,k;1===g.getMonth()&&g.getDate()>27&&g.setDate(30),g.setMonth(g.getMonth()-i*j);let l=X(g,h)===-i;c=(0,W.toDate)(a),+(b=(0,W.toDate)(c),(e=(0,W.toDate)(b)).setHours(23,59,59,999),e)==+(k=(f=(0,W.toDate)(b)).getMonth(),f.setFullYear(f.getFullYear(),k+1,0),f.setHours(23,59,59,999),f)&&1===j&&1===X(a,h)&&(l=!1),d=i*(j-Number(l))}return 0===d?0:d}(h,g))<12){let a=Math.round(o/Y.minutesInMonth);return k.formatDistance("xMonths",a,m)}{let a=i%12,b=Math.trunc(i/12);return a<3?k.formatDistance("aboutXYears",b,m):a<9?k.formatDistance("overXYears",b,m):k.formatDistance("almostXYears",b+1,m)}}(c,(0,V.constructFrom)(c,Date.now()),d))}),a.status&&(0,b.jsx)(g.StatusBadge,{status:a.status.name,className:"text-[10px] px-1.5 py-0"})]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a.reply_description})]})]},a.id)}):(0,b.jsx)("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No activity yet"}),("technician"===l||"requestor"===l||"admin"===l)&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(o,{}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)(p.Textarea,{placeholder:"Add a reply or update...",value:u,onChange:a=>v(a.target.value),rows:3}),(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsxs)(e.Button,{onClick:A,disabled:!u.trim()||w,className:"gap-2",children:[w?(0,b.jsx)(T.Loader2,{className:"h-4 w-4 animate-spin"}):(0,b.jsx)(P.Send,{className:"h-4 w-4"}),w?"Posting...":"Post Reply"]})})]})]})]})]})]}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsx)(f.CardTitle,{className:"text-base",children:"Details"})}),(0,b.jsxs)(f.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,b.jsx)(N.Building2,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Department"}),(0,b.jsx)("p",{className:"font-medium",children:m.service_request_type?.department?.name})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,b.jsx)(M,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Created"}),(0,b.jsx)("p",{className:"font-medium",children:(0,U.format)(new Date(m.request_datetime),"PPP")})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,b.jsx)(O,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Requested By"}),(0,b.jsx)("p",{className:"font-medium",children:m.requester?.name})]})]}),m.assigned_to&&(0,b.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,b.jsx)(Q.CheckCircle2,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Assigned To"}),(0,b.jsx)("p",{className:"font-medium",children:m.assigned_to.name})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,b.jsx)(R.Clock,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Request Type"}),(0,b.jsx)("p",{className:"font-medium",children:m.service_request_type?.name})]})]})]})]}),("technician"===l||"hod"===l||"admin"===l)&&(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsx)(f.CardTitle,{className:"text-base",children:"Actions"})}),(0,b.jsxs)(f.CardContent,{className:"space-y-2",children:[m.status?.name==="Pending"&&(0,b.jsx)(e.Button,{className:"w-full",variant:"outline",children:"Mark In Progress"}),m.status?.name==="In Progress"&&(0,b.jsx)(e.Button,{className:"w-full gradient-primary",children:"Mark Completed"}),"hod"===l&&"Pending"===m.approval_status&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(e.Button,{className:"w-full",variant:"default",children:"Approve Request"}),(0,b.jsx)(e.Button,{className:"w-full",variant:"outline",children:"Reassign"})]})]})]})]})]})]}):(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Request not found"}),(0,b.jsx)(e.Button,{variant:"link",onClick:()=>j.back(),children:"Go back"})]})}function ae(){return(0,b.jsx)(ad,{})}a.s(["default",()=>ae],43609)}];

//# sourceMappingURL=_a4138371._.js.map